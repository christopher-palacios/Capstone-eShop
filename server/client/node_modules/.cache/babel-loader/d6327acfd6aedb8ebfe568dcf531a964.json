{"ast":null,"code":"import _regeneratorRuntime from\"/Users/christopherpalacios/Desktop/christopher-palacios-capstone-c41/eShop/server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/christopherpalacios/Desktop/christopher-palacios-capstone-c41/eShop/server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/christopherpalacios/Desktop/christopher-palacios-capstone-c41/eShop/server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext,useState,useEffect}from\"react\";import swal from\"sweetalert\";import axios from\"axios\";// https://e-shop-cp.herokuapp.com/api\nimport{jsx as _jsx}from\"react/jsx-runtime\";export var AppContext=/*#__PURE__*/createContext();export var ContextProvider=function ContextProvider(_ref){var children=_ref.children;var baseUrl=\"https://e-shop-cp.herokuapp.com/api\";var token=localStorage.getItem(\"token\");// const user = localStorage.getItem(\"user\");\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),selectedCategory=_useState2[0],setSelectedCategory=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),productList=_useState4[0],setProductList=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),selectedProduct=_useState6[0],setSelectedProduct=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),categoryList=_useState10[0],setCategoryList=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),randomItems=_useState12[0],setRandomItems=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),currentUser=_useState14[0],setCurrentUser=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),drop=_useState16[0],setDrop=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),cart=_useState18[0],setCart=_useState18[1];var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),purchased=_useState20[0],setPurchased=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),logInModalShow=_useState22[0],setLogInModalShow=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),signUpModalShow=_useState24[0],setSignUpModalShow=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isSignedIn=_useState26[0],setIsSignedIn=_useState26[1];var storage=JSON.parse(localStorage.getItem(\"guestCart\"));var guestCart={isOpen:true,products:[],cartQuantity:0,cartTotal:0};//Get list of categories\nvar getCategoryList=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:axios.get(\"\".concat(baseUrl,\"/categories\")).then(function(res){setCategoryList(res.data);}).catch(function(err){return swal(err.message);});case 1:case\"end\":return _context.stop();}}},_callee);}));return function getCategoryList(){return _ref2.apply(this,arguments);};}();//Get product list\nvar getProductList=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:axios.get(\"\".concat(baseUrl,\"/product/list\")).then(function(res){setProductList(res.data);}).catch(function(err){return swal(err.message);});case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function getProductList(){return _ref3.apply(this,arguments);};}();//CART FUNCTIONS//\n//Get cart\nvar getCart=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:axios.get(\"\".concat(baseUrl,\"/cart\"),{headers:{authorization:\"Bearer \".concat(token)}}).then(function(res){return setCart(res.data);}).catch(function(err){return swal(\"getCart\",err.message);});case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function getCart(){return _ref4.apply(this,arguments);};}();//INCREASE product quantity in cart\nvar increaseQty=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(product,cartId){var _guestCart,index;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(token){_context4.next=12;break;}console.log(\"no toke\");_guestCart=JSON.parse(localStorage.getItem(\"guestCart\"));//find product index in guest cart\nindex=_guestCart.products.map(function(product){return product.name;}).indexOf(product.name);//update product quantity\n_guestCart.products[index].quantity=_guestCart.products[index].quantity+1;_guestCart.products[index].productTotal=_guestCart.products[index].productTotal+product.price;//recalculate cart totals\n_guestCart.cartTotal=_guestCart.products.map(function(product){return product.productTotal;}).reduce(function(acc,curr){return acc+curr;});_guestCart.cartQuantity=_guestCart.products.map(function(product){return product.quantity;}).reduce(function(acc,curr){return acc+curr;});//save guest cart to state and local storage\nsetCart(_guestCart);localStorage.setItem(\"guestCart\",JSON.stringify(_guestCart));_context4.next=21;break;case 12:if(!token){_context4.next=21;break;}_context4.prev=13;_context4.next=16;return axios.put(\"\".concat(baseUrl,\"/cart/increase/\").concat(cartId),{product:product,cartId:cartId},{headers:{authorization:\"Bearer \".concat(token)}}).then(function(res){return setCart(res.data);},setLoading(false));case 16:_context4.next=21;break;case 18:_context4.prev=18;_context4.t0=_context4[\"catch\"](13);swal(\"Please login or create an account to add items to your cart\",_context4.t0.message);case 21:case\"end\":return _context4.stop();}}},_callee4,null,[[13,18]]);}));return function increaseQty(_x,_x2){return _ref5.apply(this,arguments);};}();//DECREASE product quantity in cart\nvar decreaseQty=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(product,cartId){var _guestCart2,index;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(token){_context5.next=11;break;}_guestCart2=JSON.parse(localStorage.getItem(\"guestCart\"));//find product index in guest cart\nindex=_guestCart2.products.map(function(product){return product.name;}).indexOf(product.name);//update product quantity\n_guestCart2.products[index].quantity=_guestCart2.products[index].quantity-1;_guestCart2.products[index].productTotal=_guestCart2.products[index].productTotal-product.price;//recalculate cart totals\n_guestCart2.cartTotal=_guestCart2.products.map(function(product){return product.productTotal;}).reduce(function(acc,curr){return acc+curr;});_guestCart2.cartQuantity=_guestCart2.products.map(function(product){return product.quantity;}).reduce(function(acc,curr){return acc+curr;});//save guest cart to state and local storage\nsetCart(_guestCart2);localStorage.setItem(\"guestCart\",JSON.stringify(_guestCart2));_context5.next=19;break;case 11:_context5.prev=11;_context5.next=14;return axios.put(\"\".concat(baseUrl,\"/cart/decrease/\").concat(cartId),{product:product},{headers:{authorization:\"Bearer \".concat(token)}}).then(function(res){return setCart(res.data);}).catch(function(err){return swal(err.message);});case 14:_context5.next=19;break;case 16:_context5.prev=16;_context5.t0=_context5[\"catch\"](11);swal(_context5.t0.message);case 19:case\"end\":return _context5.stop();}}},_callee5,null,[[11,16]]);}));return function decreaseQty(_x3,_x4){return _ref6.apply(this,arguments);};}();//DELETE selected product from cart\nvar deleteProduct=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(product,cartId){var _guestCart3;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(token){_context6.next=7;break;}_guestCart3=JSON.parse(localStorage.getItem(\"guestCart\"));//remove selected product from guest cart\nif(_guestCart3.products.length===1){_guestCart3.products=[];_guestCart3.cartTotal=0;_guestCart3.cartQuantity=0;}else if(_guestCart3.products.length>1){_guestCart3.products=_guestCart3.products.filter(function(item){return item.name!==product.name;});//recalculate cart totals\n_guestCart3.cartTotal=_guestCart3.products.map(function(product){return product.productTotal;}).reduce(function(acc,curr){return acc+curr;});_guestCart3.cartQuantity=_guestCart3.products.map(function(product){return product.quantity;}).reduce(function(acc,curr){return acc+curr;});}//save guest cart to state and local storage\nsetCart(_guestCart3);localStorage.setItem(\"guestCart\",JSON.stringify(_guestCart3));_context6.next=15;break;case 7:_context6.prev=7;_context6.next=10;return axios.put(\"\".concat(baseUrl,\"/cart/delete/\").concat(cartId),{product:product,cartId:cartId},{headers:{authorization:\"Bearer \".concat(token)}}).then(function(res){return setCart(res.data);}).catch(function(err){return swal(err.message);});case 10:_context6.next=15;break;case 12:_context6.prev=12;_context6.t0=_context6[\"catch\"](7);swal(_context6.t0.message);case 15:case\"end\":return _context6.stop();}}},_callee6,null,[[7,12]]);}));return function deleteProduct(_x5,_x6){return _ref7.apply(this,arguments);};}();// const getRandom = () => {\n//   const randomIndex = Math.floor(Math.random() * categoryList?.length);\n//   const randomId = categoryList[randomIndex]?._id;\n//   axios.get(`${baseUrl}/categories/${randomId}`).then((res) => {\n//     setRandomItems(res.data);\n//     console.log(res.data);\n//   });\n// };\nuseEffect(function(){getCategoryList();getProductList();// getRandom();\nif(!token&&storage===null){setCart(guestCart);localStorage.setItem(\"guestCart\",JSON.stringify(guestCart));}else if(!token&&storage){var _guestCart4=JSON.parse(localStorage.getItem(\"guestCart\"));setCart(_guestCart4);}if(token){localStorage.removeItem(\"guestCart\");getCart();}},[token]);return/*#__PURE__*/_jsx(AppContext.Provider,{value:{baseUrl:baseUrl,randomItems:randomItems,setRandomItems:setRandomItems,isSignedIn:isSignedIn,setIsSignedIn:setIsSignedIn,logInModalShow:logInModalShow,setLogInModalShow:setLogInModalShow,signUpModalShow:signUpModalShow,setSignUpModalShow:setSignUpModalShow,selectedCategory:selectedCategory,setSelectedCategory:setSelectedCategory,selectedProduct:selectedProduct,setSelectedProduct:setSelectedProduct,loading:loading,setLoading:setLoading,categoryList:categoryList,setCategoryList:setCategoryList,productList:productList,currentUser:currentUser,setCurrentUser:setCurrentUser,getCategoryList:getCategoryList,drop:drop,setDrop:setDrop,cart:cart,setCart:setCart,token:token,increaseQty:increaseQty,decreaseQty:decreaseQty,deleteProduct:deleteProduct,purchased:purchased,setPurchased:setPurchased},children:children});};","map":{"version":3,"sources":["/Users/christopherpalacios/Desktop/christopher-palacios-capstone-c41/eShop/server/client/src/AppContext/AppContext.jsx"],"names":["React","createContext","useState","useEffect","swal","axios","AppContext","ContextProvider","children","baseUrl","token","localStorage","getItem","selectedCategory","setSelectedCategory","productList","setProductList","selectedProduct","setSelectedProduct","loading","setLoading","categoryList","setCategoryList","randomItems","setRandomItems","currentUser","setCurrentUser","drop","setDrop","cart","setCart","purchased","setPurchased","logInModalShow","setLogInModalShow","signUpModalShow","setSignUpModalShow","isSignedIn","setIsSignedIn","storage","JSON","parse","guestCart","isOpen","products","cartQuantity","cartTotal","getCategoryList","get","then","res","data","catch","err","message","getProductList","getCart","headers","authorization","increaseQty","product","cartId","console","log","index","map","name","indexOf","quantity","productTotal","price","reduce","acc","curr","setItem","stringify","put","decreaseQty","deleteProduct","length","filter","item","removeItem"],"mappings":"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","sourcesContent":["import React, { createContext, useState, useEffect } from \"react\";\nimport swal from \"sweetalert\";\nimport axios from \"axios\";\n\n// https://e-shop-cp.herokuapp.com/api\nexport const AppContext = createContext();\n\nexport const ContextProvider = ({ children }) => {\n  const baseUrl = \"https://e-shop-cp.herokuapp.com/api\";\n  const token = localStorage.getItem(\"token\");\n  // const user = localStorage.getItem(\"user\");\n  const [selectedCategory, setSelectedCategory] = useState([]);\n  const [productList, setProductList] = useState([]);\n  const [selectedProduct, setSelectedProduct] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [categoryList, setCategoryList] = useState([]);\n  const [randomItems, setRandomItems] = useState([]);\n  const [currentUser, setCurrentUser] = useState();\n  const [drop, setDrop] = useState(\"\");\n  const [cart, setCart] = useState([]);\n  const [purchased, setPurchased] = useState();\n  const [logInModalShow, setLogInModalShow] = useState(false);\n  const [signUpModalShow, setSignUpModalShow] = useState(false);\n  const [isSignedIn, setIsSignedIn] = useState(false);\n  let storage = JSON.parse(localStorage.getItem(\"guestCart\"));\n  const guestCart = {\n    isOpen: true,\n    products: [],\n    cartQuantity: 0,\n    cartTotal: 0,\n  };\n\n  //Get list of categories\n  const getCategoryList = async () => {\n    axios\n      .get(`${baseUrl}/categories`)\n      .then((res) => {\n        setCategoryList(res.data);\n      })\n      .catch((err) => swal(err.message));\n  };\n\n  //Get product list\n  const getProductList = async () => {\n    axios\n      .get(`${baseUrl}/product/list`)\n      .then((res) => {\n        setProductList(res.data);\n      })\n      .catch((err) => swal(err.message));\n  };\n\n  //CART FUNCTIONS//\n  //Get cart\n  const getCart = async () => {\n    axios\n      .get(`${baseUrl}/cart`, {\n        headers: {\n          authorization: `Bearer ${token}`,\n        },\n      })\n      .then((res) => setCart(res.data))\n      .catch((err) => swal(\"getCart\", err.message));\n  };\n\n  //INCREASE product quantity in cart\n  const increaseQty = async (product, cartId) => {\n    if (!token) {\n      console.log(\"no toke\");\n      let guestCart = JSON.parse(localStorage.getItem(\"guestCart\"));\n      //find product index in guest cart\n      let index = guestCart.products\n        .map((product) => product.name)\n        .indexOf(product.name);\n      //update product quantity\n      guestCart.products[index].quantity =\n        guestCart.products[index].quantity + 1;\n      guestCart.products[index].productTotal =\n        guestCart.products[index].productTotal + product.price;\n      //recalculate cart totals\n      guestCart.cartTotal = guestCart.products\n        .map((product) => product.productTotal)\n        .reduce((acc, curr) => acc + curr);\n      guestCart.cartQuantity = guestCart.products\n        .map((product) => product.quantity)\n        .reduce((acc, curr) => acc + curr);\n      //save guest cart to state and local storage\n      setCart(guestCart);\n      localStorage.setItem(\"guestCart\", JSON.stringify(guestCart));\n    } else if (token) {\n      try {\n        await axios\n          .put(\n            `${baseUrl}/cart/increase/${cartId}`,\n            { product, cartId },\n            {\n              headers: {\n                authorization: `Bearer ${token}`,\n              },\n            }\n          )\n          .then((res) => setCart(res.data), setLoading(false));\n      } catch (error) {\n        swal(\n          \"Please login or create an account to add items to your cart\",\n          error.message\n        );\n      }\n    }\n  };\n\n  //DECREASE product quantity in cart\n  const decreaseQty = async (product, cartId) => {\n    if (!token) {\n      let guestCart = JSON.parse(localStorage.getItem(\"guestCart\"));\n      //find product index in guest cart\n      let index = guestCart.products\n        .map((product) => product.name)\n        .indexOf(product.name);\n      //update product quantity\n      guestCart.products[index].quantity =\n        guestCart.products[index].quantity - 1;\n      guestCart.products[index].productTotal =\n        guestCart.products[index].productTotal - product.price;\n      //recalculate cart totals\n      guestCart.cartTotal = guestCart.products\n        .map((product) => product.productTotal)\n        .reduce((acc, curr) => acc + curr);\n      guestCart.cartQuantity = guestCart.products\n        .map((product) => product.quantity)\n        .reduce((acc, curr) => acc + curr);\n      //save guest cart to state and local storage\n      setCart(guestCart);\n      localStorage.setItem(\"guestCart\", JSON.stringify(guestCart));\n    } else {\n      try {\n        await axios\n          .put(\n            `${baseUrl}/cart/decrease/${cartId}`,\n            { product },\n            {\n              headers: {\n                authorization: `Bearer ${token}`,\n              },\n            }\n          )\n          .then((res) => setCart(res.data))\n          .catch((err) => swal(err.message));\n      } catch (error) {\n        swal(error.message);\n      }\n    }\n  };\n\n  //DELETE selected product from cart\n  const deleteProduct = async (product, cartId) => {\n    if (!token) {\n      let guestCart = JSON.parse(localStorage.getItem(\"guestCart\"));\n      //remove selected product from guest cart\n      if (guestCart.products.length === 1) {\n        guestCart.products = [];\n        guestCart.cartTotal = 0;\n        guestCart.cartQuantity = 0;\n      } else if (guestCart.products.length > 1) {\n        guestCart.products = guestCart.products.filter(\n          (item) => item.name !== product.name\n        );\n        //recalculate cart totals\n        guestCart.cartTotal = guestCart.products\n          .map((product) => product.productTotal)\n          .reduce((acc, curr) => acc + curr);\n        guestCart.cartQuantity = guestCart.products\n          .map((product) => product.quantity)\n          .reduce((acc, curr) => acc + curr);\n      }\n\n      //save guest cart to state and local storage\n      setCart(guestCart);\n      localStorage.setItem(\"guestCart\", JSON.stringify(guestCart));\n    } else {\n      try {\n        await axios\n          .put(\n            `${baseUrl}/cart/delete/${cartId}`,\n            { product, cartId },\n            {\n              headers: {\n                authorization: `Bearer ${token}`,\n              },\n            }\n          )\n          .then((res) => setCart(res.data))\n          .catch((err) => swal(err.message));\n      } catch (error) {\n        swal(error.message);\n      }\n    }\n  };\n  // const getRandom = () => {\n  //   const randomIndex = Math.floor(Math.random() * categoryList?.length);\n  //   const randomId = categoryList[randomIndex]?._id;\n\n  //   axios.get(`${baseUrl}/categories/${randomId}`).then((res) => {\n  //     setRandomItems(res.data);\n  //     console.log(res.data);\n  //   });\n  // };\n\n  useEffect(() => {\n    getCategoryList();\n    getProductList();\n    // getRandom();\n    if (!token && storage === null) {\n      setCart(guestCart);\n      localStorage.setItem(\"guestCart\", JSON.stringify(guestCart));\n    } else if (!token && storage) {\n      let guestCart = JSON.parse(localStorage.getItem(\"guestCart\"));\n      setCart(guestCart);\n    }\n\n    if (token) {\n      localStorage.removeItem(\"guestCart\");\n      getCart();\n    }\n  }, [token]);\n\n  return (\n    <AppContext.Provider\n      value={{\n        baseUrl,\n        randomItems,\n        setRandomItems,\n        isSignedIn,\n        setIsSignedIn,\n        logInModalShow,\n        setLogInModalShow,\n        signUpModalShow,\n        setSignUpModalShow,\n        selectedCategory,\n        setSelectedCategory,\n        selectedProduct,\n        setSelectedProduct,\n        loading,\n        setLoading,\n        categoryList,\n        setCategoryList,\n        productList,\n        currentUser,\n        setCurrentUser,\n        getCategoryList,\n        drop,\n        setDrop,\n        cart,\n        setCart,\n        token,\n        increaseQty,\n        decreaseQty,\n        deleteProduct,\n        purchased,\n        setPurchased,\n      }}\n    >\n      {children}\n    </AppContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}